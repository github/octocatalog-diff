name: CI
on: [push, pull_request, workflow_dispatch]
jobs:
  puppet-7-30-0:
    env:
      PUPPET_VERSIONS: "7.30.0"
      PUPPET_VERSION: "7.30.0"
      RUBOCOP_TEST: false
      RSPEC_TEST: true
    runs-on: ubuntu-latest
    permissions:
      contents: read
    strategy:
      fail-fast: false
      matrix:
        ruby-version: ["2.6"]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Build container
        run: docker build . --file Dockerfile --tag octocatalog-diff:ruby${{matrix.ruby-version}} --build-arg RUBY_VERSION=${{matrix.ruby-version}} --build-arg PUPPET_VERSION=${{env.PUPPET_VERSION}}
      - name: Tests
        run: docker run -e PUPPET_VERSION -e PUPPET_VERSIONS -e RSPEC_TEST -e RUBOCOP_TEST -e ENFORCE_COVERAGE octocatalog-diff:ruby${{matrix.ruby-version}} /app/script/cibuild
